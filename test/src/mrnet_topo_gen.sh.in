#!/bin/sh


FANOUT=$1
HEIGHT=$2
COREC=$3
CPN=$4
NCPS=$5
ROOTPATH=$6
TOTAL_NC=$7

TOPOGEN=@MRNETTOPGEN@
HOSTLISTFILE_BE=$SLURM_JOBID/"hl-file-be"
HOSTLISTFILE_CP=$SLURM_JOBID/"hl-file-cp"
TOPO=$SLURM_JOBID/topo

mkdir $SLURM_JOBID
rm -f $HOSTLISTFILE_BE $HOSTLISTFILE_CP $TOPO

echo "srun -n $TOTAL_NC -N $TOTAL_NC $ROOTPATH/gen_hostlist $HOSTLISTFILE_BE $HOSTLISTFILE_CP $COREC $CPN $NCPS"
srun -n $TOTAL_NC -N $TOTAL_NC $ROOTPATH/gen_hostlist $HOSTLISTFILE_BE $HOSTLISTFILE_CP $COREC $CPN $NCPS

echo "$TOPOGEN -b $HOSTLISTFILE_BE -c $HOSTLISTFILE_CP --topology=b:$FANOUT^$HEIGHT -o $TOPO"
$TOPOGEN -b $HOSTLISTFILE_BE -c $HOSTLISTFILE_CP --topology=b:$FANOUT^$HEIGHT -o $TOPO

