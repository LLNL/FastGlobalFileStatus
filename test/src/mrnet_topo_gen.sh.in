#!/bin/sh

FANOUT=$1
HEIGHT=$2
COREC=$3
CPONLYN=$4
COREPERCP=$5
ROOTPATH=$6
TOTAL_NC=$7
CPERBENODE=$8

TOPOGEN=@MRNETTOPGEN@
HOSTLISTFILE="${SLURM_JOBID}/hl-file"
HOSTLISTFILE_BE="${SLURM_JOBID}/hl-file-be"
HOSTLISTFILE_CP="${SLURM_JOBID}/hl-file-cp"
TOPO="$SLURM_JOBID/topo"

mkdir $SLURM_JOBID
rm -f $HOSTLISTFILE_BE $HOSTLISTFILE_CP $TOPO

#srun -n $TOTAL_NC -N $TOTAL_NC $ROOTPATH/gen_hostlist $HOSTLISTFILE_BE $HOSTLISTFILE_CP $COREC $CPN $NCPS
echo "srun -n $TOTAL_NC -N $TOTAL_NC $ROOTPATH/gen_hostlist $HOSTLISTFILE $HOSTLISTFILE_BE $HOSTLISTFILE_CP $COREC $CPONLYN $COREPERCP $CPERBENODE"
srun -n $TOTAL_NC -N $TOTAL_NC $ROOTPATH/gen_hostlist $HOSTLISTFILE $HOSTLISTFILE_BE $HOSTLISTFILE_CP $COREC $CPONLYN $COREPERCP $CPERBENODE

sleep 10
ls $SLURM_JOBID
sleep 10

echo "$ROOTPATH/my_topo_gen  $HOSTLISTFILE_BE $HOSTLISTFILE_CP $FANOUT^$HEIGHT $TOPO"
$ROOTPATH/my_topo_gen  $HOSTLISTFILE_BE $HOSTLISTFILE_CP $FANOUT^$HEIGHT $TOPO
